---
- name: Configure VLANs and Ports on Cisco 3750 TS Switches (Core)
  hosts: core_switches
  collections:
    - cisco.ios
  gather_facts: no
  connection: network_cli

  tasks:
    - name: Create VLANs on core switches
      cisco.ios.ios_vlans:
        vlan_id: "{{ item.id }}"
        name: "{{ item.name }}"
        state: present
      loop: "{{ vlan_definitions }}"

    - name: Configure trunk ports on core switches
      cisco.ios.ios_interfaces:
        name: "{{ item }}"
        mode: trunk
        trunk_vlans: "10,20,30,40,50"
        description: "Trunk port for uplink or firewall"
      loop: "{{ trunk_ports }}"

    - name: Configure PowerEdge access ports (VLAN 10)
      cisco.ios.ios_interfaces:
        name: "{{ item }}"
        mode: access
        access_vlan: 10
        description: "Infra VLAN 10 access port"
      loop: "{{ poweredge_ports }}"

    - name: Configure access ports for Rivendell VLAN 10
      cisco.ios.ios_interfaces:
        name: "{{ item }}"
        mode: access
        access_vlan: 10
        description: "Infra VLAN 10 access port"
      loop: "{{ access_ports.rivendell }}"
      when: access_ports.rivendell | length > 0

