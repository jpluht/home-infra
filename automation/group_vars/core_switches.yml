---
# Group variables for Cisco Core Switches
# 
# These are device-specific settings applied to all hosts in core_switches group.
# VLAN definitions and port mappings are loaded dynamically from vault-config.yml
# via include_vars in the playbook (see automation/playbooks/core_switches.yml)

# ====================================================================
# Cisco IOS Connection Defaults
# ====================================================================
ansible_connection: network_cli
ansible_network_os: cisco.ios.ios
ansible_become: yes
ansible_become_method: enable

# ====================================================================
# VLAN Configuration
# ====================================================================
# Source of truth: .private/vault-config.yml (loaded at playbook runtime)
# 
# Vault config structure (per VLAN):
#   - id: 10
#     name: "Valinor"
#     subnet: "192.168.10.0/24"
#     gateway: "192.168.10.1"
#     access_level: "management"
#
# This playbook loads vlans via:
#   include_vars: file=.private/vault-config.yml name=vault_config

# ====================================================================
# Trunk Port Configuration
# ====================================================================
# Trunk ports: uplinks to firewall, distribution, or other core switches
# These connect to OPNsense or serve as inter-switch links

trunk_ports_default:
  - "GigabitEthernet0/1"      # Uplink to OPNsense firewall
  - "GigabitEthernet0/2"      # Backup uplink / inter-switch trunk
  
# Define trunk vlans (will be populated from vault_config)
# trunk_vlans will be generated by playbook: vault_config.vlans | map(attribute='id') | join(',')

# ====================================================================
# Port Speed and Duplex
# ====================================================================
interface_speed: "auto"
interface_duplex: "auto"

# ====================================================================
# DHCP Snooping (trust relationships)
# ====================================================================
dhcp_snooping_enabled: yes
dhcp_snooping_trust_ports:
  - "GigabitEthernet0/1"      # Trust ports: DHCP server uplinks
  - "GigabitEthernet0/2"

# ====================================================================
# Port Security
# ====================================================================
port_security_enabled: yes
port_security_violation: "shutdown"
port_security_aging_time: 2  # minutes

# ====================================================================
# Storm Control (prevent broadcast storms)
# ====================================================================
storm_control_enabled: yes
storm_control_broadcast_level: 10  # percent
storm_control_multicast_level: 10
storm_control_unicast_level: 10

# ====================================================================
# Management Interface Configuration
# ====================================================================
# Management VLAN on core switches (typically VLAN 10 - Valinor)
mgmt_vlan: 10
# mgmt_ip will be defined per-host in inventory

# ====================================================================
# Spanning Tree Configuration
# ====================================================================
spanning_tree_mode: "pvst"
spanning_tree_pathcost_method: "short"
spanning_tree_portfast_default: yes

# ====================================================================
# VTP (VLAN Trunking Protocol) - typically disabled in modern setups
# ====================================================================
vtp_mode: "off"

# ====================================================================
# Access Port Mappings (per-device override in inventory)
# ====================================================================
# Example per device in .private/inventory/hosts.yml:
#   access_ports:
#     - interface: "Gi0/3"
#       vlan_id: 20
#       description: "Proxmox hypervisor"
#       speed: "1000"
#     - interface: "Gi0/4"
#       vlan_id: 20
#       description: "GPU compute node"
#       speed: "1000"

# ====================================================================
# Default ACLs (extended access lists for inter-VLAN filtering)
# ====================================================================
# These can be configured if advanced filtering is needed
# Typically firewall (OPNsense) handles inter-VLAN policies
acl_enabled: no
