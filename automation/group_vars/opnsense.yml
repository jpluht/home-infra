---
# VLAN Configuration
vlans:
  - id: 10
    name: "{{ vault_vlan_10_name }}"
    description: "Infrastructure network"
    subnet: 10.0.1.0/24
    gateway: 10.0.1.1
  - id: 20
    name: "{{ vault_vlan_20_name }}"
    description: "Trusted personal devices"
    subnet: 10.0.2.0/24
    gateway: 10.0.2.1
  - id: 30
    name: "{{ vault_vlan_30_name }}"
    description: "General users and entertainment"
    subnet: 10.0.3.0/24
    gateway: 10.0.3.1
  - id: 40
    name: "{{ vault_vlan_40_name }}"
    description: "Virtual machines"
    subnet: 10.0.4.0/24
    gateway: 10.0.4.1
  - id: 50
    name: "{{ vault_vlan_50_name }}"
    description: "IoT and isolated devices"
    subnet: 10.0.5.0/24
    gateway: 10.0.5.1

# DHCP configuration for VLANs
dhcp:
  enabled_vlans:
    - vlan_id: 30
      range_start: 10.0.3.100
      range_end: 10.0.3.200

    - vlan_id: 50
      range_start: 10.0.5.100
      range_end: 10.0.5.200

# Firewall rules
firewall:
  allow:
    - name: "Allow infrastructure to trusted devices"
      interface: "opt1"
      action: pass
      protocol: any
      source_ip: 10.0.1.0/24
      destination_subnet: 10.0.2.0/24
  block:
    - name: "Block isolated VLAN to WAN"
      interface: "opt4"
      action: block
      protocol: any
      source_subnet: 10.0.5.0/24
      destination: any

    - name: "Block isolated VLAN to other VLANs"
      interface: "opt4"
      action: block
      protocol: any
      source_subnet: 10.0.5.0/24
      destination_exclude: 10.0.5.0/24

# NAT rules
nat_rules:
  - description: "Outbound NAT for all traffic via WAN"
    interface: wan
    source: any
    destination: any
    type: automatic

# NTP Servers
ntp:
  servers:
    - 0.europe.pool.ntp.org
    - 1.europe.pool.ntp.org
    - 2.europe.pool.ntp.org

# SSH settings - RESTRICTED ACCESS
ssh:
  permit_root_login: false
  permit_empty_password: false
  permit_password_auth: true
  max_auth_tries: 3
  port: 22
  allow_users:
    - admin
  # SSH access limited to Management VLAN only
  # Implemented via firewall rules (see firewall.ssh_access below)

# Web UI settings - RESTRICTED ACCESS
web_ui:
  protocol: https
  port: 443
  max_connections: 10
  session_timeout: 1800  # 30 minutes
  # Web UI access limited to Management VLAN only

# Management Access Control
management_access:
  enabled_vlans:
    - 10  # Management VLAN ONLY for SSH/HTTPS
  allowed_source_ips: []  # Empty = from Management VLAN only

# DDoS & Rate Limiting
ddos_protection:
  enabled: true
  # SYN flood protection
  syn_flood:
    threshold: 10000
    period: 10
  # Port scan detection
  port_scan_detection: true
  port_scan_threshold: 100
  # ICMP rate limiting
  icmp_rate_limit: 100/sec
  # UDP rate limiting
  udp_rate_limit: 1000/sec

# VPN (WireGuard) - OPTIONAL, currently disabled
vpn_wireguard:
  enabled: false
  # When enabled: strictly control peer access, rotate keys quarterly
  peers: []
  allowed_vlans:
    - 10  # Management VLAN only

# DHCP Security
dhcp_security:
  # Enable DHCP snooping to prevent rogue DHCP servers
  snooping_enabled: true
  # DAI (Dynamic ARP Inspection)
  dai_enabled: true
  # Per-VLAN DHCP option 82 (circuit ID)
  option_82_enabled: true

# DNS Security
dns_security:
  # Use DNS over HTTPS (DoH) or DNSSEC
  dnssec_enabled: true
  dnssec_validation: strict
  # DNS rebinding protection
  rebinding_protection: true
  # Whitelist only needed FQDNs (deny by default)
  whitelist_only: false
  # Rate limit DNS queries per source
  rate_limit: 100/sec

# DNSBL & DNS Filtering
dnsbl_enabled: true
dnsbl_blocklists:
  - "EasyList"
  - "Blocklist.de"

pfblockerng:
  enabled: true
  dnsbl_lists:
    - "Spamhaus DROP"
    - "Spamhaus EDROP"

# Suricata IDS/IPS
suricata_enabled: true
suricata_mode: "ips"  # Intrusion Prevention (not just detection)
suricata_rules:
  - "emerging-threats"
  - "bleeding-edge"
  - "ptresearch/attackdetection"
suricata_settings:
  alert_threshold: "medium"  # Alert on medium+ severity
  eve_log: true  # JSON logging for alerts
  stats_log: true
  drop_rules: true  # Actually block (not just alert)

# Connection Tracking & Timeouts
connection_settings:
  tcp_idle_timeout: 900  # 15 minutes
  udp_idle_timeout: 60   # 1 minute
  icmp_timeout: 30       # 30 seconds
  # Track connections per source IP (detect port scanners)
  track_state: true
  max_states_per_source: 10000

# Logging & Monitoring - CRITICAL
logging:
  # Syslog for centralized logging
  syslog_enabled: true
  syslog_server: "{{ vault_syslog_server }}"  # From vault, e.g., 10.0.x.100
  syslog_protocol: tls  # Use TLS for security, not UDP
  syslog_port: 6514
  syslog_facility: "local0"
  
  # Log levels
  firewall_log_level: "debug"
  suricata_log_level: "info"
  dhcp_log_level: "info"
  
  # What to log
  log_blocked_connections: true
  log_allowed_connections: false  # Too verbose, disable unless troubleshooting
  log_port_scan_attempts: true
  log_dhcp_activity: true
  log_dns_queries: false  # Too verbose for production
  
  # Retention
  local_log_retention: 30  # Keep local logs 30 days
  archive_logs: false  # Consider enabling + shipping to remote storage

# DNS Servers - USE REPUTABLE, PRIVACY-FOCUSED
dns_servers:
  # Primary: Quad9 (security-focused, malware blocking)
  - "9.9.9.9"
  # Secondary: Cloudflare (privacy-focused)
  - "1.1.1.1"
  # Do NOT use: Google (8.8.8.8), OpenDNS (208.67.222.222) - data harvesting

# System Security Settings
system_security:
  # Password policy
  password_min_length: 14
  password_complexity: true
  password_history: 5
  password_expire_days: 90
  
  # Failed login tracking
  failed_login_threshold: 5
  failed_login_lockout_minutes: 15
  
  # Firewall state table
  scrub_packets: true  # Normalize packets (prevent exploits)
  block_fragments: true
  block_invalid: true
  
  # Randomize IP IDs (prevent fingerprinting)
  randomize_ids: true

# API Security (if Ansible communicates via API)
api_security:
  api_enabled: true
  api_key_rotation: 90  # days
  api_tls_version: "1.3"
  api_disable_weak_ciphers: true

domain_name: "internal.local"

# NOTE: Vault-managed secrets (not shown in plaintext)
# - vault_syslog_server: Management VLAN IP of syslog collector
# - Any API keys or sensitive configuration data

