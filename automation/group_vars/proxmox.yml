---
# Group variables for Proxmox cluster nodes
# 
# VLAN and network configuration is loaded from .private/vault-config.yml
# at playbook runtime via include_vars (see automation/playbooks/proxmox.yml)

# ====================================================================
# Proxmox SSH Connection Defaults
# ====================================================================
ansible_connection: ssh
ansible_user: root
ansible_become: no  # Root already

# ====================================================================
# Cluster Configuration
# ====================================================================
proxmox_cluster_name: "home-lab"
proxmox_cluster_quorum: yes

# ====================================================================
# Network Bridge Configuration (loaded from vault-config.vlans)
# ====================================================================
# Playbook creates bridges for each VLAN:
#   vmbr0 → VLAN 10 (Valinor - management)
#   vmbr1 → VLAN 20 (Rivendell - infrastructure)
#   vmbr2 → VLAN 40 (Moria - VM guests)
#   etc.
#
# Each bridge will have gateway and DHCP configured per vault_config

# ====================================================================
# Storage Configuration
# ====================================================================
storage_nodes:
  - name: "local"
    type: "dir"
    path: "/var/lib/vz"
    nodes: "all"
    content: "images,rootdir"
    disabled: no
    
  # Additional storage can be configured:
  # - name: "ceph-cluster"
  #   type: "ceph"
  #   content: "images"

# ====================================================================
# VM Template Defaults
# ====================================================================
# Templates are created from ISO images
vm_template_defaults:
  memory: 2048        # MB
  cores: 2
  sockets: 1
  cpu_type: "kvm64"
  vga: "std"
  net_model: "virtio"

# ====================================================================
# Backup & Restore
# ====================================================================
backup_enabled: yes
backup_schedule: "02 00 * * *"     # 00:02 UTC daily
backup_retention_days: 7
backup_compress: "lz4"              # lz4, gzip, or zstd

# ====================================================================
# HA (High Availability) Configuration
# ====================================================================
ha_enabled: no
# ha_shutdown_policy: "migrate"
# ha_reboot_policy: "auto"

# ====================================================================
# Monitoring & Logging
# ====================================================================
syslog_enabled: yes
# syslog_server: "192.168.10.100"   # Set in inventory
syslog_facility: "local0"

# ====================================================================
# Repository Configuration (Proxmox Enterprise, Community, Testing)
# ====================================================================
# By default: use Community repository (free)
apt_repos:
  - name: "community"
    url: "http://download.proxmox.com/debian/pve"
    suite: "bookworm"
    enabled: yes
  - name: "ceph-reef"
    url: "http://download.proxmox.com/debian/ceph-reef"
    suite: "bookworm"
    enabled: no

# ====================================================================
# Firewall Rules (Proxmox host-level)
# ====================================================================
firewall_enabled: yes
firewall_default_policy: "drop"

# Allow SSH from management VLAN only (loaded from vault-config)
firewall_ssh_allowed_sources:
  - "192.168.10.0/24"    # Valinor management VLAN
